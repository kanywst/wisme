# WIMSE セキュリティに関する考慮事項

## WIMSE アイデンティティのセキュリティ

### 信頼ドメインのスコープ

WIMSE識別子は発行者内でスコープされるため、識別子のサブコンポーネント（識別子のパス部分）は信頼ドメインによって定義された範囲内でのみ一意です。信頼ドメインを考慮せずにWIMSE識別子を使用すると、あるドメインが別のドメイン内のアイデンティティを偽装するトークンを発行できる可能性があります。

さらに、信頼ドメインは、JWKSやX.509証明書チェーンなどのメカニズムを通じて、認可された発行者の暗号化信頼アンカーに関連付けられている必要があります。発行者、信頼ドメイン、暗号化信頼アンカーの関連付けは、帯域外で安全に通信される必要があります。

## Workload Identity Token（WIT）と所有証明

Workload Identity Token（WIT）は秘密の暗号鍵にバインドされており、セクション4.1で説明されているように、常に所有証明（Proof of Possession、PoP）と共に提示されます。WITは複数のコンテキストで提示できる汎用トークンです。WITとそのPoPはアプリケーションレベルのオプションでのみ使用され、mTLSでは使用されません。WITをベアラートークンとして使用してはなりません。

これによりトークンの機密性は低減されますが、トークンとその所有証明がPoPの有効期間内にキャプチャされて再生される可能性はまだあります。以下は、所有証明（PoP）のキャプチャと再利用に対するいくつかの緩和策です：

### TLSによる盗聴と傍受の防止

通信チャネルを観察または傍受する攻撃者は、トークンとその所有証明を見て、それを再生して利益を得ようとする可能性があります。これを防ぐために、トークンと所有証明は、他のメカニズムによって安全なチャネルが提供されない限り、安全なサーバー認証済みのTLS接続を介して送信する必要があります。セクション5に従ってホスト名検証を実行する必要があります。WIT自体は所有証明なしでは使用できません。

### 所有証明の有効期間の制限

所有証明は時間制限されている必要があります。PoPは、必要な目的のために正常に使用するのに必要な時間内でのみ有効であるべきです。これは通常、分単位の時間です。有効期間外に受信したPoPは拒否する必要があります。

### 所有証明の範囲の制限

盗難と再生のリスクを減らすために、PoPの範囲を制限する必要があります。例えば、PoPは特定のワークロードや特定のトランザクションでの使用を対象とし、盗まれたPoPの影響を軽減することができます。場合によっては、ワークロードが一定期間PoPを再利用したり、複数のターゲットワークロードで受け入れられるようにしたりすることがあります。PoPが漏洩し、攻撃者がキャプチャされたWITと共に提示できるようになった場合のシステムへの影響を理解するために、慎重な分析が必要です。

### タイムスタンプまたはノンスへのバインディング

所有証明には、一意のタイムスタンプやノンスなど、それを一意に識別するために使用できる情報を含める必要があります。これは、受信者が既に見たトークンに対する基本的なリプレイ保護を実行するために使用できます。システムの設計によっては、すべてのトークン検証者間でリプレイキャッシュを同期させることが難しい場合があります。この場合、PoPが十分にスコープされていないと、別のワークロードで使用できる可能性があります。新しいノンスをPoPに含めることはできますが、PoPの単一使用特性を提供するために検証者から新しいチャレンジノンスを配布するメカニズムはこの仕様の範囲外です。

### TLSエンドポイントへのバインディング

PoPは、TLSセッションのクライアントアイデンティティやTLSチャネルバインディングパラメータなど、トランスポート層の送信者にバインドすることができます。バインディングのメカニズムはこの仕様の範囲外です。

## ミドルボックス

一部のデプロイメントでは、WIMSEトークンと所有証明が複数のシステムを通過する場合があります。システム間の通信はTLS経由ですが、トークンとPoPは各中間者で平文で利用可能です。中間者はトークンや所有証明内の情報を変更することはできませんが、トークンをキャプチャして再生したり、PoPによって保護されていないデータを変更したりする可能性があります。前のセクションにリストされている緩和策は、ミドルボックスからのある程度の保護を提供するために使用できます。デプロイメントは、ミドルボックスを信頼し、トラフィックを通過させることが適切かどうかを判断するために、自身の状況に対する分析を実行する必要があります。

## プライバシーに関する考慮事項

WITと所有証明には、ユーザー名やその他のアイデンティティなどの個人情報が含まれている場合があります。この情報の漏洩を防ぐために注意が必要です。TLSの使用は、WITと所有証明のプライバシーを保護するのに役立ちます。

WITとWIMSE識別子を持つ証明書は通常、特定のユーザーではなくワークロードに関連付けられていますが、一部のデプロイメントではワークロードが直接ユーザーに関連付けられている場合があります。これらは例外的なケースですが、デプロイメントはWITまたは証明書の開示がユーザーの追跡に使用できるかどうかを評価する必要があります。

## セキュリティのベストプラクティス

WIMSE実装のセキュリティを確保するために、以下のベストプラクティスを考慮してください：

1. **強力な暗号化アルゴリズムの使用**: WITの署名と所有証明には、業界標準の強力な暗号化アルゴリズムを使用します。

2. **短い有効期間**: WITとPoPの両方に適切な有効期間を設定します。WITは定期的に更新し（例：数時間ごと）、PoPの有効期間はさらに短くします（例：数分または数秒）。

3. **安全な鍵管理**: 秘密鍵の生成、保存、ローテーションのための安全なプラクティスを実装します。可能な場合は、ハードウェアセキュリティモジュール（HSM）または同様のセキュリティ機能を使用します。

4. **最小権限の原則**: ワークロードに必要な最小限の権限のみを付与します。これにより、侵害された場合の潜在的な影響が制限されます。

5. **監査とログ記録**: セキュリティイベントの監査証跡を維持し、異常なアクティビティを検出するためにログを定期的に確認します。

6. **失効メカニズム**: 侵害された場合にWITを迅速に失効させるメカニズムを実装します。

7. **定期的なセキュリティレビュー**: WIMSE実装のセキュリティを定期的に評価し、新たな脆弱性や脅威に対処します。
