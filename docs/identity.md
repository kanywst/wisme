# WIMSE ワークロードアイデンティティ

## 信頼ドメイン（Trust Domain）

信頼ドメインは、共通のセキュリティコントロールとポリシーを共有するシステムの論理的なグループです。WIMSE証明書とトークンは、信頼ドメインの権限の下で発行されます。

### 信頼ドメインの特徴

- 信頼ドメインは、組織に属する完全修飾ドメイン名（FQDN）によって識別されるべきです
- 信頼ドメインは、X.509証明書を検証するための1つ以上の信頼アンカーと、WIMSE WITトークンを検証するためのJWK Set（JSON Web Key Set）を安全に取得するメカニズムにマッピングされます
- このマッピングは、マッピングの真正性と整合性が最新であり、侵害されていないことを保証する安全なメカニズムを通じて取得する必要があります

### 複数の信頼ドメイン

単一の組織が、異なる部門や環境など、異なる目的のために複数の信頼ドメインを定義することがあります。各信頼ドメインは一意の識別子を持つ必要があります。ワークロード識別子は信頼ドメイン内でスコープされます。信頼ドメインのみが異なる2つの識別子は、2つの異なるエンティティを参照します。

## ワークロード識別子（Workload Identifier）

WIMSEでは、ワークロード識別子はURI（Uniform Resource Identifier）として定義されています。このURIは、後述する証明書やトークンのサブジェクトフィールドで使用されます。

### ワークロード識別子の要件

- URIは相対URIであってはならず、RFC3986で指定されたURI構文とエンコーディングルールに従う必要があります
- URIにはスキームとスキーム固有部分の両方を含める必要があります
- URIには、識別子がスコープされる信頼ドメインを識別する権限（authority）を含める必要があります
- 信頼ドメインは、信頼ドメイン識別子の一意性を確保するために、組織に属する完全修飾ドメイン名であるべきです
- スキームとスキーム固有部分はこの仕様では定義されていません
- この定義に準拠する識別子形式の例としては、SPIFFE ID（https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE-ID.md）があります
- URIエンコーディングルールではホスト名をIPアドレスとして指定できますが、既存の命名スキームとの互換性が必要な場合を除き、信頼ドメインを表すためにIPアドレスを使用してはなりません

### ワークロード識別子の例

```
wimse://example.com/specific-workload
```

この例では：
- `wimse://` はスキームです
- `example.com` は信頼ドメインです
- `/specific-workload` はスキーム固有部分で、特定のワークロードを識別します

## ワークロードアイデンティティの使用

ワークロードアイデンティティは、以下の2つの方法で使用されます：

1. **アプリケーションレベルの認証**：
   - Workload Identity Token (WIT) として、JWS（JSON Web Signature）で署名されたJWT（JSON Web Token）の形式で使用
   - WITはアイデンティティサーバーによって発行され、公開鍵をワークロードアイデンティティにバインドします

2. **相互TLS認証**：
   - X.509証明書のSubjectAltName拡張のURI型としてエンコードされます
   - WIMSE証明書には、URI型のSubjectAltName拡張が1つだけ含まれている必要があります
